<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{/layout/header::head('이벤트작성게시판')}"></head>

<style>
  .ck.ck-editor {
    max-width: 1000px;
  }
  .ck-editor__editable {
    min-height: 400px;
  }
  .ck-content {
    color: gray;
  }
</style>

<body>

  <div th:replace="~{/layout/header::header}"></div>

  <div>이벤트글 작성하로왔니?</div>
  
  <div>
    <form id="frm_event_write" method="post" th:action="@{/event/addevent.do}" enctype="multipart/form-data">
      <div>
        <label for="title">제목</label>
        <input type="text" name="title" id="title">
      </div>
      
      <div>
        <textarea name="contents" id="contents" class="form-control"></textarea>
      </div>
      
      <div>
        <label for="files" class="form-label">1개의 썸네일 첨부</label>
        <input type="file" id="files" name="files" multiple class="form-control">
      </div>
      
       <div>
        <label for="files" class="form-label">이벤트사진</label>
        <input type="file" name="event_images" id="event_images" class="form-control" multiple>
       </div>
      
      <div>
        <label id="startAt">시작일</label>
        <input type="date" name="startAt"  class="startAt">
      </div>
      
      <div>
        <label id="discountPercent">할인율</label>
        <input type="text" name="discountPercent" id="discountPercent" value="0">
      </div>
      
      <div>
        <label id="discountPrice">할인가</label>
        <input type="text" name="discountPrice" id="discountPrice" value="0">
      </div>
      
      <div>
        <label id="endAt">종료일</label>
        <input type="date" name="endAt" class="endAt">
      </div>
      
      <hr>
      
      <div>
        <button class="btn btn-primary col-12 eventWrite" type="submit">작성완료</button>
      </div>
      
    </form>
  </div>
<script th:inline="javascript">
  
  
  function StartDatechecking() {
    $(document).on('blur', '.startAt', function(ev){
      let dateCheck = /^[0-9]{4}-[0-9]{2}-\d{2}$/;
      let datevalue = $('.startAt').val();
      let startDate = $('.startAt').val().replaceAll('-','');
      let endDate = $('.endAt').val().replaceAll('-','');
      
      let today = new Date();
      let year = today.getFullYear(); // 년도
      let month = today.getMonth() + 1;  // 월
      let date = String(today.getDate()).padStart(2,"0");  // 날짜
      let full = year+'-'+month+'-'+date;
      let withoutfull = (full).replaceAll('-','');
      
      if(startDate != 0 && endDate != 0){
        if(startDate - endDate < 0){
        alert('종료일이 시작일보다 느릴수없습니다. 시작일을 현재날짜로 설정합니다.');
        return $('.startAt').val(full);
        }
      }
      
      
      if(!dateCheck.test(datevalue)){
       alert('해당 시작일은 설정이 불가합니다. 현재날짜로 재설정합니다.');
       return $('.startAt').val(full);
      } 
      
      datevalue = datevalue.replaceAll('-','');
      
      if((datevalue - withoutfull) < 0){
        alert('지난 날짜는 선택할 수 없습니다. 현재날짜로 재설정합니다.');
        $('.startAt').val(full);
        return $('.startAt').val(full);
      }
    })
  }
  
  function endDatechecking() {
    $(document).on('blur', '.endAt', function(ev){
      let dateCheck = /^[0-9]{4}-[0-9]{2}-\d{2}$/;
      let datevalue = $('.endAt').val();
      let startDate = $('.startAt').val().replaceAll('-','');
      let endDate = $('.endAt').val().replaceAll('-','');
      
      
      let today = new Date();   
      let year = today.getFullYear(); // 년도
      let month = today.getMonth() + 1;  // 월
      let date = String(today.getDate()).padStart(2,"0");  // 날짜
      let full = year+'-'+month+'-'+date;
      let withoutfull = (year+'/'+month+'/'+date).replaceAll('/','');
      
      if(!dateCheck.test(datevalue)){
        alert('해당 종료일은 설정이 불가합니다. 현재날짜로 재설정합니다.');
        return $('.endAt').val(full);
      }
      
      datevalue = datevalue.replaceAll('-','');
      if((datevalue-withoutfull) < 0){
        alert('지난 날짜는 선택할 수 없습니다. 현재날짜로 재설정합니다.');
        return $('.endAt').val(full);
      }
      if(startDate == 0){
        alert('시작일을 설정하지않았습니다. 현재날짜로 설정합니다.');
        return $('.startAt'),val(full);
      }
      
      if(endDate == 0){
        alert('종료일을 설정하지않았습니다. 현재날짜로 설정합니다.');
        return $('.startAt'),val(full);
      }
      
      if(endDate-startDate < 0) {
        alert('종료일이 시작일보다 느릴수없습니다. 시작일을 현재날짜로 설정합니다.');
        return $('.startAt').val(full);
      }
      
    })
  }
  
  
  
  
  StartDatechecking();
  endDatechecking();
  
  
  
  
  
const fnCkeditor = () => {
    ClassicEditor
      .create(document.getElementById('contents'), {
        toolbar: {
          items: [
            'undo', 'redo',
            '|', 'heading',
            '|', 'fontfamily', 'fontsize', 'fontColor', 'fontBackgroundColor',
            '|', 'bold', 'italic', 'strikethrough', 'subscript', 'superscript', 'code',
            '|', 'link', 'uploadImage', 'blockQuote', 'codeBlock',
            '|', 'bulletedList', 'numberedList', 'todoList', 'outdent', 'indent'
          ],
          shouldNotGroupWhenFull: false
       },
       heading: {
         options: [
           { model: 'paragraph', title: 'Paragraph', class: 'ck-heading_paragraph' },
           { model: 'heading1', view: 'h1', title: 'Heading 1', class: 'ck-heading_heading1' },
           { model: 'heading2', view: 'h2', title: 'Heading 2', class: 'ck-heading_heading2' },
           { model: 'heading3', view: 'h3', title: 'Heading 3', class: 'ck-heading_heading3' },
           { model: 'heading4', view: 'h4', title: 'Heading 4', class: 'ck-heading_heading4' },
           { model: 'heading5', view: 'h5', title: 'Heading 5', class: 'ck-heading_heading5' },
           { model: 'heading6', view: 'h6', title: 'Heading 6', class: 'ck-heading_heading6' }
         ]
       },
       ckfinder: {
         // 이미지 업로드 경로
         uploadUrl: '/event/imageUpload.do',
       }
     })
     .catch(err => {
       console.log(err)
     });
  }
  
  
  
  
  fnCkeditor();

</script>  
  
  
  <div th:replace="~{/layout/footer::footer}"></div>

</body>
</html>